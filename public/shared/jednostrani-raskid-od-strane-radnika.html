<!DOCTYPE html>
<html lang="sr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jednostrani raskid od strane radnika</title>

    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/shared/images/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/shared/images/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/shared/images/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/shared/site.webmanifest" />

    <!-- Dynamic Favicon Script - automatski menja putanje na osnovu domena -->
    <script src="/shared/components/dynamic-favicon.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/shared/cookie-consent.css" />

    <!-- ExportUtils dependencies -->
    <script src="/shared/components/export-utils.js"></script>

    <!-- PDF export dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      body {
        font-family: 'Times New Roman', serif;
        line-height: 1.6;
        background-color: #f8f9fa;
      }
      .document-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        margin-bottom: 20px;
      }
      
      .btn-group-vertical {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      .btn-group-vertical .btn {
        margin: 2px 0;
        min-width: 120px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      .content {
        text-align: justify;
        line-height: 1.8;
      }
      
      .signature-section {
        display: flex;
        justify-content: space-between;
        margin-top: 60px;
        padding-top: 20px;
      }
      
      .signature-box {
        text-align: center;
        width: 45%;
      }
      
      .signature-box p {
        margin: 5px 0;
      }
      
      .underline {
        border-bottom: 1px solid black;
        display: inline-block;
        min-width: 200px;
        margin: 0 5px;
      }

      @media print {
        .btn-group-vertical {
          display: none !important;
        }
        body {
          background: white !important;
          margin: 0;
          padding: 0;
          font-size: 14px;
          line-height: 1.4;
        }
        .document-container {
          box-shadow: none;
          margin: 0;
          padding: 25px;
          max-width: 100%;
          page-break-inside: avoid;
        }
        .header {
          margin-bottom: 25px;
        }
        .header h2 {
          font-size: 18px;
          margin: 0 0 15px 0;
        }
        .content p {
          margin-bottom: 16px !important;
          font-size: 14px;
          line-height: 1.4;
        }
        .content {
          margin-bottom: 20px;
        }
        /* Optimalni razmaci za celu stranicu */
        div[style*="margin-top: 40px"] {
          margin-top: 30px !important;
        }
        div[style*="margin-top: 60px"] {
          margin-top: 40px !important;
        }
        div[style*="margin-top: 30px"] {
          margin-top: 25px !important;
        }
        /* Napomena na dno */
        div[style*="border-top"] {
          margin-top: 30px !important;
          padding-top: 15px !important;
          font-size: 12px;
          line-height: 1.3;
        }
        @page {
          margin: 2cm;
          size: A4;
        }
      }
    </style>
  </head>
  <body>
    <div class="btn-group-vertical">
      <button class="btn btn-primary print-btn" onclick="window.print()">
        üñ®Ô∏è ≈†tampaj
      </button>
      <button class="btn btn-danger pdf-btn" onclick="exportToPDF()">
        üìÑ PDF
      </button>
      <button class="btn btn-success word-btn" onclick="downloadWordCompact()">
        üìù Word
      </button>
      <button class="btn btn-warning jpr-btn" onclick="openJPRSimple()">
        üìã Otvori JPR
      </button>
    </div>

    <div class="document-container">
      <div class="header">
        <h2><strong>IZJAVA O JEDNOSTRANOM RASKIDU UGOVORA O RADU</strong></h2>
      </div>

      <div class="content">
        <p style="margin-bottom: 20px">
          Ja,<br>
          <span id="imeRadnika">________________</span>,<br>
          JMBG: <span id="jmbgRadnika">________________</span>,<br>
          zaposlen/a na radnom mjestu <span id="pozicijaRadnika">________________</span>,<br>
          u preduzeƒáu <span id="nazivFirme">________________</span>,<br>
        </p>

        <p style="margin-bottom: 20px">
          na osnovu ƒçlana 171 Zakona o radu Crne Gore (‚ÄûSlu≈æbeni list CG", br. 74/19 i 8/23),<br>
          podnosim sljedeƒáu:
        </p>

        <p style="margin-bottom: 30px; text-align: center; color: blue;">
          <strong>IZJAVU</strong>
        </p>

        <p style="margin-bottom: 20px">
          Izjavljujem da jednostrano raskidam Ugovor o radu zakljuƒçen dana <span id="datumZaposlenja">________________</span> 
          izmeƒëu mene i poslodavca <span id="nazivFirme">________________</span>.
        </p>

        <p style="margin-bottom: 20px">
          U skladu sa ƒçlanom 171 Zakona o radu, po≈°tuje otkazni rok od <strong> 15 dana</strong>,<br>
          koji poƒçinje da teƒçe od dana dostavljanja ove izjave poslodavcu, osim ukoliko se poslodavac<br>
          saglasi sa kraƒáim rokom prestanka radnog odnosa. Po isteku navedenog roka, moj radni<br>
          odnos kod poslodavca prestaje.
        </p>

        <p style="margin-bottom: 20px">
          Molim da mi se po prestanku radnog odnosa izda potvrda o radu (radna knji≈æica / potvrda o<br>
          zaposlenju), kao i da se izvr≈°i obraƒçun i isplata svih zakonskih i ugovorom pripaƒëajuƒáih<br>
          potra≈æivanja.
        </p>
      </div>

      <div style="margin-top: 40px">
        <p>U <span id="gradFirme">________________</span>, dana <span id="datumOtkaza">________________</span></p>
      </div>

      <div style="margin-top: 60px">
        <p>____________________<br>
        (potpis radnika)</p>
      </div>

      <div style="margin-top: 30px">
        <p><strong>Ime i prezime:</strong> <span id="imeRadnika2">________________</span><br>
        <strong>Kontakt telefon / e-mail:</strong> <span id="kontaktRadnika">________________</span></p>
      </div>

      <div style="margin-top: 40px; border-top: 1px solid #ccc; padding-top: 20px">
        <p><strong>Napomena:</strong><br>
        Zakonom o radu Crne Gore (ƒçlan 171) propisano je da radnik mo≈æe otkazati ugovor o radu<br>
        uz otkazni rok od najmanje 15 dana, osim ako ugovorom o radu nije drugaƒçije odreƒëeno.<br>
        Ova izjava se dostavlja pismeno poslodavcu (liƒçno uz potvrdu o prijemu ili preporuƒçenom<br>
        po≈°tom).</p>
      </div>
        
        <div class="signature-box">
          <p>____________________</p>
          <p><strong>PRIJEM POSLODAVCA</strong></p>
          <p>Datum i potpis</p>
        </div>
      </div>
    </div>

    <script>
      // Dobijanje podataka iz URL parametara
      const urlParams = new URLSearchParams(window.location.search);
      const radnikId = urlParams.get('radnikId');
      const firmaId = urlParams.get('firmaId');
      const otkazId = urlParams.get('otkazId');

      // Uƒçitavanje podataka kada se stranica uƒçita
      document.addEventListener('DOMContentLoaded', async function () {
        if (radnikId && firmaId) {
          await loadData();
        }
      });

      async function loadData() {
        try {
          // Uƒçitaj podatke o radniku
          const radnikResponse = await fetch(`/api/radnici/id/${radnikId}`);
          const radnik = await radnikResponse.json();

          // Uƒçitaj podatke o firmi
          const firmaResponse = await fetch(`/api/firme/id/${firmaId}`);
          const firma = await firmaResponse.json();

          // Popuni osnovne podatke
          document.getElementById('imeRadnika').textContent = `${radnik.ime} ${radnik.prezime}`;
          document.getElementById('imeRadnika2').textContent = `${radnik.ime} ${radnik.prezime}`;
          document.getElementById('jmbgRadnika').textContent = radnik.jmbg || '________________';
          document.getElementById('pozicijaRadnika').textContent = radnik.pozicija_naziv || 'Radnik';
          
          // Popuni podatke o firmi - sva pojavljivanja
          const nazivFirmeElements = document.querySelectorAll('#nazivFirme');
          nazivFirmeElements.forEach(el => {
            el.textContent = firma.naziv || '________________';
          });
          
          document.getElementById('gradFirme').textContent = firma.grad || '________________';
          document.getElementById('datumZaposlenja').textContent = 
            radnik.datum_zaposlenja ? new Date(radnik.datum_zaposlenja).toLocaleDateString('sr-RS') : '________________';

          // Popuni kontakt podatke radnika
          let kontakt = '';
          if (radnik.telefon) kontakt += radnik.telefon;
          if (radnik.email) {
            if (kontakt) kontakt += ' / ';
            kontakt += radnik.email;
          }
          if (document.getElementById('kontaktRadnika')) {
            document.getElementById('kontaktRadnika').textContent = kontakt || '________________';
          }

          // Ako imamo otkazId, uƒçitaj podatke o otkazu
          if (otkazId) {
            try {
              const otkazResponse = await fetch(`/api/otkazi/${otkazId}`);
              const otkazData = await otkazResponse.json();
              
              if (otkazResponse.ok && otkazData.success && otkazData.otkaz) {
                const otkaz = otkazData.otkaz;
                
                if (otkaz.datum_otkaza) {
                  const datumFormatiran = new Date(otkaz.datum_otkaza).toLocaleDateString('sr-RS');
                  
                  const datumElements = document.querySelectorAll('#datumOtkaza');
                  datumElements.forEach(el => {
                    el.textContent = datumFormatiran;
                  });
                }
              }
            } catch (error) {
              console.error('Gre≈°ka pri uƒçitavanju otkaza:', error);
            }
          } else {
            // Ako nema otkazId, postavi dana≈°nji datum
            const datumElements = document.querySelectorAll('#datumOtkaza');
            datumElements.forEach(el => {
              el.textContent = new Date().toLocaleDateString('sr-RS');
            });
          }

        } catch (error) {
          console.error('Gre≈°ka pri uƒçitavanju podataka:', error);
          alert('Gre≈°ka pri uƒçitavanju podataka. Molimo poku≈°ajte ponovo.');
        }
      }

      // Export funkcije
      async function exportToPDF() {
        await ExportUtils.exportToPDF({
          containerSelector: '.document-container',
          filePrefix: 'Jednostrani_Raskid_Radnik',
          getFileName: () => {
            const radnikIme = document.getElementById('imeRadnika')?.textContent || 'Radnik';
            const firmaNaziv = document.getElementById('nazivFirme')?.textContent || 'Firma';
            return `Jednostrani_Raskid_Radnik_${radnikIme.replace(/\s+/g, '_')}_${firmaNaziv.replace(/\s+/g, '_')}.pdf`;
          }
        });
      }

      function downloadWordCompact() {
        ExportUtils.exportToWord({
          containerSelector: '.document-container',
          filePrefix: 'Jednostrani_Raskid_Radnik',
          compact: true,
          getFileName: () => {
            const radnikIme = document.getElementById('imeRadnika')?.textContent || 'Radnik';
            const firmaNaziv = document.getElementById('nazivFirme')?.textContent || 'Firma';
            return `Jednostrani_Raskid_Radnik_${radnikIme.replace(/\s+/g, '_')}_${firmaNaziv.replace(/\s+/g, '_')}.docx`;
          }
        });
      }

      // JPR funkcionalnost (pojednostavljena verzija)
      function openJPRSimple() {
        try {
          if (!firmaId) {
            alert('Gre≈°ka: nedostaju potrebni parametri za JPR (firmaId)');
            return;
          }

          const radnikIme = document.getElementById('imeRadnika')?.textContent || '';
          const jmbgRadnika = document.getElementById('jmbgRadnika')?.textContent || '';

          // Otvori JPR koricu sa parametrima za jednostrani raskid
          const jprUrl = `/jpr-korica.html?firmaId=${firmaId}&radnikId=${radnikId}&ime=${encodeURIComponent(radnikIme)}&jmbg=${encodeURIComponent(jmbgRadnika)}&tip=jednostrani_raskid`;
          window.open(jprUrl, '_blank');

        } catch (error) {
          console.error('Gre≈°ka pri otvaranju JPR-a:', error);
          alert('Gre≈°ka pri otvaranju JPR-a: ' + error.message);
        }
      }
    </script>
  </body>
</html>