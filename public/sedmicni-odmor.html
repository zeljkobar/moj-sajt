<!DOCTYPE html>
<html lang="sr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odluka o sedmiƒçnom odmoru</title>
    
    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="images/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="images/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="images/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="site.webmanifest" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- PDF/Word Export libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Export Utils module -->
    <script src="components/export-utils.js"></script>
    <style>
      body {
        font-family: 'Times New Roman', serif;
        background-color: #f8f9fa;
        padding: 20px;
      }
      .document-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        min-height: 297mm;
        padding: 40px;
      }
      .header {
        text-align: center;
        margin-bottom: 40px;
      }
      .title {
        font-size: 24px;
        font-weight: bold;
        margin: 20px 0;
        text-transform: uppercase;
      }
      .content {
        line-height: 1.8;
        text-align: justify;
      }
      .signature-section {
        margin-top: 80px;
        display: flex;
        justify-content: space-between;
      }
      .print-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }
      @media print {
        .print-button,
        .pdf-button,
        .word-button,
        .edit-button,
        .export-buttons,
        .btn-warning,
        .btn-success,
        .btn-info,
        .modal {
          display: none !important;
        }
        body {
          background: white;
          padding: 0;
        }
        .document-container {
          box-shadow: none;
        }
      }

      /* Kompaktna dugmad kao na ugovoru o radu */
      .print-button,
      .pdf-button,
      .word-button,
      .edit-button {
        position: fixed;
        right: 20px;
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        z-index: 1000;
        min-width: 80px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .print-button {
        top: 20px;
        background-color: #007bff;
      }

      .pdf-button {
        top: 80px;
        background-color: #dc3545;
      }

      .word-button {
        top: 140px;
        background-color: #6f42c1;
      }

      .edit-button {
        top: 200px;
        background-color: #ffc107;
        color: #000;
      }

      .print-button:hover,
      .pdf-button:hover,
      .word-button:hover,
      .edit-button:hover {
        opacity: 0.8;
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <!-- Export dugmad - kompaktno kao na ugovoru o radu -->
    <button class="print-button" onclick="window.print()">üñ®Ô∏è ≈†tampaj</button>
    <button class="pdf-button" onclick="downloadPDF()">üìÑ PDF</button>
    <button class="word-button" onclick="downloadWord()">üìù Word</button>
    <button class="edit-button" onclick="otvoriModalDanOdmora()">
      ‚úèÔ∏è Promeni
    </button>

    <!-- Modal za izbor dana sedmiƒçnog odmora -->
    <div
      class="modal fade"
      id="danOdmoraModal"
      tabindex="-1"
      aria-labelledby="danOdmoraModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="danOdmoraModalLabel">
              <i class="fas fa-calendar-week me-2"></i>Izaberite dan sedmiƒçnog
              odmora
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="danSelect" class="form-label">Dan u nedelji:</label>
              <select class="form-select" id="danSelect">
                <option value="ponedeljkom">Ponedeljkom</option>
                <option value="utorkom">Utorkom</option>
                <option value="sredom">Sredom</option>
                <option value="ƒçetvrtkom">ƒåetvrtkom</option>
                <option value="petkom">Petkom</option>
                <option value="subotom">Subotom</option>
                <option value="nedeljom">Nedeljom</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="specificniDatum" class="form-label"
                >Ili specifiƒçan datum (opciono):</label
              >
              <input type="date" class="form-control" id="specificniDatum" />
              <small class="form-text text-muted"
                >Ako unesete datum, on ƒáe imati prioritet nad danom u
                nedelji</small
              >
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Otka≈æi
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="potvrdiDanOdmora()"
            >
              <i class="fas fa-check me-2"></i>Potvrdi
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="document-container">
      <div class="header">
        <div id="firmaHeader">
          <h3 id="firmaNaziv">Uƒçitavanje...</h3>
          <p id="firmaAdresa">Uƒçitavanje...</p>
        </div>
      </div>

      <div class="content">
        <p style="text-align: justify; margin-bottom: 20px; line-height: 1.6">
          Na osnovu ƒçlana 62 Zakona o radu (Sl. List CG, br.49/08 i izmjena CG
          br.59/11. Sl. 74/19)
          <strong id="firmaNazivText">COCCOPAZZO D.O.O.</strong> donosi,
        </p>

        <div style="margin: 30px 0; text-align: center">
          <h2
            style="
              font-size: 24px;
              font-weight: bold;
              letter-spacing: 3px;
              margin-bottom: 10px;
            "
          >
            O D L U K U
          </h2>
          <h4
            style="
              margin-top: 15px;
              font-size: 18px;
              font-weight: normal;
              text-align: center;
            "
          >
            O kori≈°ƒáenju sedmiƒçnog odmora
          </h4>
        </div>

        <div style="margin: 25px 0">
          <p style="margin-bottom: 8px; text-align: center">
            <strong>ƒålan 1.</strong>
          </p>
          <p style="line-height: 1.8; text-align: justify">
            Zaposleni
            <u
              ><strong
                id="radnikImePrezime"
                style="
                  display: inline-block;

                  text-align: center;
                "
              ></strong></u
            >, JMBG
            <u
              ><strong
                id="radnikJmbg"
                style="
                  display: inline-block;

                  text-align: center;
                "
              ></strong></u
            >, koristi sedmiƒçni odmor dana
            <u
              ><strong
                id="datumOdmora"
                style="
                  display: inline-block;
                  min-width: 100px;
                  text-align: center;
                "
              ></strong></u
            >.
          </p>
        </div>

        <div style="margin: 25px 0">
          <p style="margin-bottom: 8px; text-align: center">
            <strong>ƒålan 2.</strong>
          </p>
          <p style="line-height: 1.8; text-align: justify">
            Sedmiƒçni odmor traje 24 ƒçasa neprekidno.
          </p>
        </div>

        <div style="margin: 25px 0">
          <p style="margin-bottom: 8px; text-align: center">
            <strong>ƒålan 3.</strong>
          </p>
          <p style="line-height: 1.8; text-align: justify">
            Ako zaposleni radi na dan svog sedmiƒçnog odmora, biƒáe mu obezbjedjen
            odmor u trajanju od 24 ƒçasa neprekidno prvog dana naredne sedmice.
          </p>
        </div>

        <div style="margin: 25px 0">
          <p style="margin-bottom: 8px; text-align: center">
            <strong>ƒålan 4.</strong>
          </p>
          <p style="line-height: 1.8; text-align: justify">
            Ova odluka je istaknuta na vidnom mjestu u prostoru gdje zaposleni
            obavlja djelatnosti.
          </p>
        </div>
      </div>

      <div class="signature-section">
        <div style="width: 100%; text-align: right; margin-top: 60px">
          <p style="margin-bottom: 10px"><strong>DIREKTOR</strong></p>
          <p
            style="
              margin-bottom: 5px;
              border-bottom: 1px solid black;
              width: 200px;
              margin-left: auto;
            "
          >
            &nbsp;
          </p>
          <p style="margin-bottom: 0; font-size: 12px" id="direktorImePrezime">
            Ime i prezime direktora
          </p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        const radnikId = urlParams.get('radnikId');
        const firmaId = urlParams.get('firmaId');

        if (radnikId && firmaId) {
          loadData(radnikId, firmaId);
        }
      });

      async function loadData(radnikId, firmaId) {
        try {
          // Uƒçitaj podatke o radniku
          const radnikResponse = await fetch(`/api/radnici/id/${radnikId}`);
          const radnik = await radnikResponse.json();

          // Uƒçitaj podatke o firmi
          const firmaResponse = await fetch(`/api/firme/id/${firmaId}`);
          const firma = await firmaResponse.json();

          // Popuni header
          document.getElementById('firmaNaziv').textContent = firma.naziv;
          document.getElementById(
            'firmaAdresa'
          ).textContent = `PIB: ${firma.pib} | ${firma.adresa}`;

          // Popuni naziv firme u tekstu
          document.getElementById('firmaNazivText').textContent = firma.naziv;

          // Popuni ime direktora iz baze podataka
          const direktorElement = document.getElementById('direktorImePrezime');
          if (firma.direktor_ime_prezime) {
            direktorElement.textContent = firma.direktor_ime_prezime;
          } else {
            direktorElement.textContent = 'Ime i prezime direktora';
          }

          // Popuni ime i prezime radnika
          document.getElementById(
            'radnikImePrezime'
          ).textContent = `${radnik.ime} ${radnik.prezime}`;

          // Popuni JMBG radnika
          document.getElementById('radnikJmbg').textContent = radnik.jmbg;

          // Proverava URL parametre za specifiƒçan dan
          const urlParams = new URLSearchParams(window.location.search);
          const danOdmora = urlParams.get('danOdmora');

          if (danOdmora) {
            document.getElementById('datumOdmora').textContent = danOdmora;
          } else {
            // Default je "ponedeljkom"
            document.getElementById('datumOdmora').textContent = 'ponedeljkom';
          }
        } catch (error) {
          console.error('Gre≈°ka pri uƒçitavanju podataka:', error);
        }
      }

      // Funkcije za modal izbora dana
      function otvoriModalDanOdmora() {
        try {
          const modalElement = document.getElementById('danOdmoraModal');
          const modal = new bootstrap.Modal(modalElement);
          modal.show();
        } catch (error) {
          console.error('Error opening modal:', error);
          alert('Gre≈°ka pri otvaranju modal-a: ' + error.message);
        }
      }

      function potvrdiDanOdmora() {
        const specificniDatum =
          document.getElementById('specificniDatum').value;
        const danSelect = document.getElementById('danSelect').value;

        let tekstZaDokument;

        if (specificniDatum) {
          // Ako je unesen specifiƒçan datum, koristi ga
          const datum = new Date(specificniDatum);
          tekstZaDokument = datum.toLocaleDateString('sr-Latn-RS');
        } else {
          // Inaƒçe koristi izabrani dan u nedelji
          tekstZaDokument = danSelect;
        }

        // Popuni dokument
        document.getElementById('datumOdmora').textContent = tekstZaDokument;

        // Zatvori modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById('danOdmoraModal')
        );
        modal.hide();
      }

      // ============================================
      // EXPORT FUNKCIJE - koristi ExportUtils modul
      // ============================================

      async function downloadPDF() {
        await ExportUtils.exportToPDF({
          containerSelector: '.document-container',
          filePrefix: 'Sedmicni_Odmor',
          getFileName: () => {
            const firmaNaziv =
              document.getElementById('firma-naziv')?.textContent || 'Firma';
            const datum = new Date()
              .toISOString()
              .slice(0, 10)
              .replace(/-/g, '_');
            return `Sedmicni_Odmor_${firmaNaziv.replace(
              /\s+/g,
              '_'
            )}_${datum}.pdf`;
          },
        });
      }

      function downloadWord() {
        ExportUtils.exportToWord({
          containerSelector: '.document-container',
          filePrefix: 'Sedmicni_Odmor',
          compact: true,
          getFileName: () => {
            const firmaNaziv =
              document.getElementById('firma-naziv')?.textContent || 'Firma';
            const datum = new Date()
              .toISOString()
              .slice(0, 10)
              .replace(/-/g, '_');
            return `Sedmicni_Odmor_${firmaNaziv.replace(
              /\s+/g,
              '_'
            )}_${datum}.doc`;
          },
        });
      }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
